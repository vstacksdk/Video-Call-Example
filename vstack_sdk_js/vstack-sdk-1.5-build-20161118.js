function HashMap(){var a=[];return a.size=function(){return this.length},a.isEmpty=function(){return 0===this.length},a.containsKey=function(a){a+="";for(var b=0;b<this.length;b++)if(this[b].key===a)return b;return-1},a.get=function(a){a+="";var b=this.containsKey(a);if(b>-1)return this[b].value},a.put=function(a,b){return a+="",this.containsKey(a)!==-1?this.get(a):void this.push({key:a,value:b})},a.allKeys=function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b].key);return a},a.allValues=function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b].value);return a},a.allIntKeys=function(){for(var a=[],b=0;b<this.length;b++)a.push(parseInt(this[b].key));return a},a.remove=function(a){a+="";var b=this.containsKey(a);b>-1&&this.splice(b,1)},a}var SERVICE_TYPE_DEFAULT=0,SERVICE_TYPE_PING=1,SERVICE_TYPE_LOGIN=2,SERVICE_TYPE_LOGOUT=3,SERVICE_TYPE_MESSAGE=4,SERVICE_TYPE_HAVE_MESSAGE=5,SERVICE_TYPE_MAKE_CONFERENCE=6,SERVICE_TYPE_MESSAGE_CONFERENCE=7,SERVICE_TYPE_HAVE_MESSAGE_CONFERENCE=8,SERVICE_TYPE_FRIEND_LIST=13,SERVICE_TYPE_FRIEND_LIST_DONE=37,SERVICE_TYPE_USER_INFO=24,SERVICE_GET_SERVER_ADDR=29,SERVICE_TYPE_MAKE_CHAT_GROUP=42,SERVICE_TYPE_LEAVE_CHAT_GROUP=43,SERVICE_TYPE_INVITE_CHAT_GROUP=44,SERVICE_TYPE_MESSAGE_CHAT_GROUP=45,SERVICE_TYPE_MESSAGE2=72,SERVICE_TYPE_HAVE_MESSAGE2=73,SERVICE_TYPE_MESSAGE_CHAT_GROUP_REPORT=74,SERVICE_TYPE_MESSAGE_STICKER=104,SERVICE_TYPE_APPLICATION_CHANGE_STATE=105,SERVICE_TYPE_MESSAGE_LOCATION=113,SERVICE_TYPE_MESSAGE_FILE_URL=121,SERVICE_TYPE_CANCEL_MESSAGE=127,SERVICE_TYPE_CHAT_TYPING=142,SERVICE_TYPE_MAKE_CHAT_GROUP_NOTIFICATION=143,SERVICE_TYPE_INVITE_CHAT_GROUP_NOTIFICATION=144,SERVICE_TYPE_LEAVE_CHAT_GROUP_NOTIFICATION=145,SERVICE_TYPE_HAVE_MESSAGE_CHAT_GROUP=146,SERVICE_TYPE_LIST_CHAT_GROUP=147,SERVICE_TYPE_CHAT_GROUP_INFO=148,SERVICE_TYPE_CHAT_GROUP_TYPING=149,SERVICE_TYPE_CHAT_GROUP_RENAME=150,SERVICE_TYPE_CHAT_GROUP_CANCEL_MESSAGE=151,SERVICE_TYPE_CHAT_GROUP_RENAME_NOTIFICATION=152,SERVICE_TYPE_MSG_SEEN=153,SERVICE_TYPE_CHAT_GROUP_NOTIFICATION_SETTINGS=158,SERVICE_TYPE_CHAT_GROUP_CHANGE_ADMIN=159,SERVICE_TYPE_AUTHENTICATION=162,SERVICE_TYPE_LIST_USERINFO_BY_USERID=164,SERVICE_TYPE_LIST_USERINFO_BY_USERNAME=165,SERVICE_TYPE_MESSAGE_REPORT2=167,SERVICE_TYPE_DELETE_MESSAGE=168,SERVICE_TYPE_LIST_MODIFIED_MESSAGES=169,SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS=170,SERVICE_TYPE_LIST_DELETE_CONVERSATION=171,SERVICE_TYPE_DELIVERED_MESSAGES=172,SERVICE_TYPE_LIST_UNREAD_MESSAGES=173,SERVICE_TYPE_MESSAGE_FROM_ME=174,SERVICE_TYPE_MESSAGE_FROM_ME_JSON=175,SERVICE_TYPE_MESSAGE_GROUP_FROM_ME=176,SERVICE_TYPE_SEEN_MESSAGES=178,SERVICE_TYPE_AUTHENTICATION_2_STEP=179,SERVICE_TYPE_LIST_CHAT_GROUPS_INFO=182,SERVICE_TYPE_LIST_MODIFIED_FILES=191,SERVICE_TYPE_CHAT_BROADCAST_CREATE_LIST=192,SERVICE_TYPE_CHAT_BROADCAST_EDIT_LIST=193,SERVICE_TYPE_CHAT_BROADCAST_GET_LIST=194,SERVICE_TYPE_MESSAGE_BROADCAST=154,SERVICE_TYPE_HAVE_MESSAGE_BROADCAST=155,SERVICE_TYPE_CHAT_BROADCAST_DELETE_LIST=195,SERVICE_TYPE_CHAT_BROADCAST_GET_MESSAGES=196,SERVICE_TYPE_CHAT_GROUP_JOIN_PUBLIC=197,SERVICE_TYPE_CHAT_GROUP_GET_LIST_PUBLIC=198,SERVICE_TYPE_LIST_CHAT_GROUPS_INFO_MORE=200,SERVICE_TYPE_CHAT_BROADCAST_INFO=201,SERVICE_TYPE_WEBRTC_CALL_INVITE=186,SERVICE_TYPE_WEBRTC_CALL_DATA=187,SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE=188,SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE_BY_ME=199,SERVICE_TYPE_CHARGING_GET_BALANCE=185,SERVICE_TYPE_JOIN_EXTERNAL_CHAT_GROUP=205,SERVICE_TYPE_JOIN_EXTERNAL_CHAT_GROUP_NOTIFICATION=206,SERVICE_TYPE_CONFERENCE_MAKE_ROOM=300,SERVICE_TYPE_CONFERENCE_JOIN_ROOM=301,vstack={packet_queue:new HashMap,send_packet_queue:new HashMap,users:new HashMap,azStackUsers:new HashMap,masterSocket:null,slaveSocket:null,groups:new HashMap,getListUserInfoByUserIdRequestId:1e3,waitingPacketByListUserId:new HashMap,callbacks:new HashMap,ignoreCallBack:[],callbackTimeoutTime:6e4,appId:null,publicKey:null,azStackUserId:null,userCredentials:null,fullname:null,slaveServerIp:null,slaveServerPort:0,logLevel:"ERROR",callbackId:0,chatProxyServer:"https://vgram.vht.com.vn:9199",sdkVersion:"2.2.4",reConnecting:!1};vstack.getCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},vstack.setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},vstack.log=function(a,b){var c=2;"ERROR"==a?c=3:"INFO"==a?c=2:"DEBUG"==a&&(c=1);var d=2;"ERROR"==this.logLevel?d=3:"INFO"==this.logLevel?d=2:"DEBUG"==this.logLevel&&(d=1),c>=d&&(null!=b&&"object"==typeof b||Array.isArray(b)?console.log(a+": "+JSON.stringify(b)):console.log(a+": "+b))},vstack.addCallback=function(a,b){this.callbacks.put(a,b)},vstack.callCallback=function(a){var b=this.callbacks.get(a);if(b){var c=new Array;for(var d in arguments)0!=d&&(c[c.length]=arguments[d]);b.apply(this,c),this.callbacks.remove(a)}},vstack.addTimeout=function(a,b,c,d){vstack.addCallback("timeout_"+a,b),setTimeout(function(){if(vstack.ignoreCallBack.indexOf("timeout_"+a)==-1)vstack.callCallback("timeout_"+a,c);else for(var b=0;b<vstack.ignoreCallBack.length;b++)if(vstack.ignoreCallBack[b]=="timeout_"+a){vstack.ignoreCallBack.splice(b,1);break}},d)},vstack.clearTimeout=function(a){vstack.ignoreCallBack.push("timeout_"+a)},vstack.sendPacketMaster=function(a,b){var c={service:a,body:JSON.stringify(b)};this.masterSocket.emit("WebPacket",c)},vstack.sendPacket=function(a,b){var c={service:a,body:JSON.stringify(b)};this.slaveSocket.emit("WebPacket",c)},vstack.connect=function(a,b,c,d,e,f){this.masterSocket=io.connect(this.chatProxyServer,{resource:"A/socket.io","force new connection":!0}),this.masterSocket.on("connect",function(){vstack.log("DEBUG","Client has connected to the MasterServer!"),vstack.sendPacketMaster(SERVICE_GET_SERVER_ADDR,{azStackUserId:c})}),this.masterSocket.on("WebPacket",function(a){var b;b=a.body.length>0?JSON.parse(a.body):{},vstack.packetReceived(a.service,b)}),this.masterSocket.on("disconnect",function(){vstack.log("DEBUG","The client has disconnected with MasterServer!")}),this.appId=a,this.publicKey=b,this.azStackUserId=c,this.userCredentials=d,this.fullname=e,this.namespace=f},vstack.packetReceived=function(a,b){a==SERVICE_GET_SERVER_ADDR?this.get_server_addr_processor(a,b):a==SERVICE_TYPE_AUTHENTICATION?this.authentication_processor(a,b):a==SERVICE_TYPE_PING?this.ping_processor(a,b):a==SERVICE_TYPE_HAVE_MESSAGE2?this.have_message_processor(a,b):a==SERVICE_TYPE_CHAT_TYPING?this.chat_typing_processor(a,b):a==SERVICE_TYPE_CHAT_GROUP_TYPING?this.chat_group_typing_processor(a,b):a==SERVICE_TYPE_USER_INFO?this.user_info_processor(a,b):a==SERVICE_TYPE_LIST_USERINFO_BY_USERNAME?this.user_info_by_username_processor(a,b):a==SERVICE_TYPE_LIST_USERINFO_BY_USERID?this.getListUserInfoByListUserIDsProcessor(a,b):a==SERVICE_TYPE_MESSAGE_FILE_URL?this.have_message_file_url_processor(a,b):a==SERVICE_TYPE_MESSAGE_LOCATION?this.have_message_location_processor(a,b):a==SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS?this.get_list_modified_conversations_processor(a,b):a==SERVICE_TYPE_LIST_MODIFIED_MESSAGES?this.get_list_modified_messages_processor(a,b):a==SERVICE_TYPE_LIST_UNREAD_MESSAGES?this.get_list_unread_messages_processor(a,b):a==SERVICE_TYPE_MESSAGE2?this.messageProcessor(a,b):a==SERVICE_TYPE_MESSAGE_REPORT2?this.messageReportProcessor(a,b):a==SERVICE_TYPE_DELIVERED_MESSAGES?this.deliveredMessagesProcessor(a,b):a==SERVICE_TYPE_LIST_CHAT_GROUPS_INFO?this.getListGroupInfoProcessor(a,b):a==SERVICE_TYPE_LIST_CHAT_GROUPS_INFO_MORE?this.getListGroupInfoMoreProcessor(a,b):a==SERVICE_TYPE_MESSAGE_CHAT_GROUP?this.messageGroupProcessor(a,b):a==SERVICE_TYPE_MESSAGE_CHAT_GROUP_REPORT?this.messageReportGroupProcessor(a,b):a==SERVICE_TYPE_HAVE_MESSAGE_CHAT_GROUP?this.haveMessageGroupProcessor(a,b):a==SERVICE_TYPE_MESSAGE_FROM_ME?this.haveMsgFromMeProcessor(a,b):a==SERVICE_TYPE_MESSAGE_FROM_ME_JSON?this.haveMsgFromMeProcessor(a,b):a==SERVICE_TYPE_MESSAGE_GROUP_FROM_ME?this.haveMsgGroupFromMeProcessor(a,b):a==SERVICE_TYPE_MAKE_CHAT_GROUP?this.makeGroupProcessor(a,b):a==SERVICE_TYPE_INVITE_CHAT_GROUP?this.inviteToGroupProcessor(a,b):a==SERVICE_TYPE_LEAVE_CHAT_GROUP?this.leaveGroupProcessor(a,b):a==SERVICE_TYPE_CHAT_GROUP_RENAME?this.renameGroupProcessor(a,b):a==SERVICE_TYPE_APPLICATION_CHANGE_STATE?this.applicationChangeStateProcessor(a,b):a==SERVICE_TYPE_CHARGING_GET_BALANCE?this.chargingGetBalanceProcessor(a,b):a==SERVICE_TYPE_CANCEL_MESSAGE?this.cancelMessageProcessor(a,b):a==SERVICE_TYPE_CHAT_GROUP_CANCEL_MESSAGE?this.groupCancelMessageProcessor(a,b):a==SERVICE_TYPE_JOIN_EXTERNAL_CHAT_GROUP?this.joinExternalProcessor(a,b):a==SERVICE_TYPE_JOIN_EXTERNAL_CHAT_GROUP_NOTIFICATION?this.joinExternalNotificationProcessor(a,b):a==SERVICE_TYPE_MAKE_CHAT_GROUP_NOTIFICATION?this.makeGroupNotificationProcessor(a,b):a==SERVICE_TYPE_INVITE_CHAT_GROUP_NOTIFICATION?this.inviteToGroupNotificationProcessor(a,b):a==SERVICE_TYPE_LEAVE_CHAT_GROUP_NOTIFICATION?this.leaveGroupNotificationProcessor(a,b):a==SERVICE_TYPE_CHAT_GROUP_RENAME_NOTIFICATION?this.renameGroupNotificationProcessor(a,b):a==SERVICE_TYPE_CHAT_GROUP_INFO?this.getGroupInfoProcessor(a,b):a==SERVICE_TYPE_LIST_DELETE_CONVERSATION?this.deleteConversationProcessor(a,b):a==SERVICE_TYPE_MSG_SEEN?this.seenMessageProcessor(a,b):a==SERVICE_TYPE_SEEN_MESSAGES?this.seenMessageProcessor(a,b):a==SERVICE_TYPE_DELETE_MESSAGE?this.deleteMessageProcessor(a,b):a==SERVICE_TYPE_LIST_CHAT_GROUP?this.listChatGroupProcessor(a,b):a==SERVICE_TYPE_CHAT_GROUP_CHANGE_ADMIN?this.chatGroupChangeAdminProcessor(a,b):a==SERVICE_TYPE_LIST_MODIFIED_FILES?this.chatListFilesProcessor(a,b):a==SERVICE_TYPE_CHAT_BROADCAST_CREATE_LIST?this.chatBroadCastCreateListProcessor(a,b):a==SERVICE_TYPE_CHAT_BROADCAST_EDIT_LIST?this.chatBroadCastEditListProcessor(a,b):a==SERVICE_TYPE_CHAT_BROADCAST_GET_LIST?this.chatBroadCastGetListProcessor(a,b):a==SERVICE_TYPE_CHAT_BROADCAST_INFO?this.getBroadcastInfoProcessor(a,b):a==SERVICE_TYPE_MESSAGE_BROADCAST?this.messageBroadCastProcessor(a,b):a==SERVICE_TYPE_HAVE_MESSAGE_BROADCAST?this.haveMessageBroadCastProcessor(a,b):a==SERVICE_TYPE_CHAT_BROADCAST_DELETE_LIST?this.chatBroadCastDeleteListProcessor(a,b):a==SERVICE_TYPE_CHAT_BROADCAST_GET_MESSAGES?this.chatBroadCastGetMessagesProcessor(a,b):a==SERVICE_TYPE_CHAT_GROUP_JOIN_PUBLIC?this.chatGroupJoinPublicProcessor(a,b):a==SERVICE_TYPE_CHAT_GROUP_GET_LIST_PUBLIC?this.chatGroupGetListPublicProcessor(a,b):a==SERVICE_TYPE_MESSAGE_STICKER?this.haveMessageStickerProcessor(a,b):a==SERVICE_TYPE_WEBRTC_CALL_INVITE?this.inviteVideoCallProcessor(a,b):a==SERVICE_TYPE_WEBRTC_CALL_DATA?this.dataVideoCallProcessor(a,b):a==SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE?this.statusVideoCallProcessor(a,b):a==SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE_BY_ME?this.statusVideoCallByMeProcessor(a,b):a==SERVICE_TYPE_CONFERENCE_MAKE_ROOM?this.conferenceMakeRoomProcessor(a,b):a==SERVICE_TYPE_CONFERENCE_JOIN_ROOM?this.conferenceJoinRoomProcessor(a,b):(vstack.log("DEBUG","unknow packet"),vstack.log("DEBUG","service: "+a),vstack.log("DEBUG",b))},vstack.azSendMessageReport=function(a,b){var c={to:a,msgId:b};this.sendPacket(SERVICE_TYPE_MESSAGE_REPORT2,c)},vstack.azSendMessageGroupReport=function(a,b,c){var d={group:a,msgId:b,msgSender:c};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP_REPORT,d)},vstack.cacheUserInfo=function(a){var b={userId:a.userId,azStackUserID:a.username,lastVisitDate:a.lastVisitDate,status:a.status,fullname:a.fullname};this.users.remove(a.userId),this.azStackUsers.remove(a.username),this.users.put(a.userId,b),this.azStackUsers.put(a.username,b)},vstack.cacheGroupInfo=function(a){var b={numberOfMembers:a.members.length,name:a.name,id:a.group,avatar:a.groupAvatar,members:a.members,admin:a.admin,type:a.type};this.groups.remove(b.id),this.groups.put(b.id,b)},vstack.addMemberGroupInfo=function(a){this.groups.get(a.group).members.push.apply(this.groups.get(a.group).members,a.members),this.groups.get(a.group).numberOfMembers=this.groups.get(a.group).members.length},vstack.getUserInfoAndRequestToServer=function(a,b){var c=this.users.get(a);if(!c){var d=this.packet_queue.get(a);return d||(d=[],this.packet_queue.put(a,d),this.sendPacket(SERVICE_TYPE_USER_INFO,{userId:a})),void d.push(b)}return c},vstack.getUserInfoAndRequestToServerWithCallBack=function(a,b,c){var d=this.users.get(a);if(this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,b),!d){var e=this.packet_queue.get(a);return e||(e=[],this.packet_queue.put(a,e),this.sendPacket(SERVICE_TYPE_USER_INFO,{userId:a,purpose:this.callbackId})),void e.push(c)}return this.clearTimeout("get_user_server_"+this.callbackId),this.callCallback("get_user_server_"+this.callbackId,[d]),d},vstack.getUserInfoByUsernameAndRequestToServerWithCallBack=function(a,b,c){var d=this.azStackUsers.get(a);if(this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,b),!d){vstack.log("DEBUG","Gui yeu cau get user_info len server de lay thong tin azStackUserID="+a);var e=this.send_packet_queue.get(a);return e||(e=[],this.send_packet_queue.put(a,e),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:[a],purpose:this.callbackId})),void e.push(c)}return this.clearTimeout("get_user_server_"+this.callbackId),this.callCallback("get_user_server_"+this.callbackId,[d]),d},vstack.getUserInfoByUsernameAndRequestToServer=function(a,b){var c=this.azStackUsers.get(a);if(!c){vstack.log("DEBUG","Gui yeu cau get user_info len server de lay thong tin azStackUserID="+a);var d=this.send_packet_queue.get(a);return d||(d=[],this.send_packet_queue.put(a,d),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:[a]})),void d.push(b)}return c},vstack.azSendMessage=function(a,b,c,d){var e={msg:a,to:0,msgId:c},f={service:SERVICE_TYPE_MESSAGE2,body:e},g=this.getUserInfoByUsernameAndRequestToServer(b,f);g&&(e.to=g.userId,this.sendPacket(SERVICE_TYPE_MESSAGE2,e),this.addTimeout("send_message_"+c,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_"+c,d))},vstack.azSendMessageFileUrl=function(a,b,c,d,e,f,g,h,i,j){var k={duration:i,to:0,id:e,fileLength:f,fileName:b,type:c,url:a,width:g,height:h},l={service:SERVICE_TYPE_MESSAGE_FILE_URL,body:k},m=this.getUserInfoByUsernameAndRequestToServer(d,l);m&&(k.to=m.userId,this.sendPacket(SERVICE_TYPE_MESSAGE_FILE_URL,k),this.addTimeout("send_message_"+e,j,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_"+e,j))},vstack.azSendMessageLocation=function(a,b,c,d,e,f){var g={id:e,long:a,lat:b,addr:c,type:4},h={service:SERVICE_TYPE_MESSAGE_LOCATION,body:g},i=this.getUserInfoByUsernameAndRequestToServer(d,h);i&&(g.to=i.userId,this.sendPacket(SERVICE_TYPE_MESSAGE_LOCATION,g),this.addTimeout("send_message_"+e,f,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_"+e,f))},vstack.azSendMessageLocationGroup=function(a,b,c,d,e,f,g){var h={group:a,groupName:b,msgId:f,type:4,long:c,lat:d,addr:e};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,h),this.addTimeout("send_message_group_"+f,g,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+f,g)},vstack.azSendMessageGroup=function(a,b,c,d){var e={msg:a,group:b,msgId:c};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,e),this.addTimeout("send_message_group_"+c,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+c,d)},vstack.azSendMessageSticker=function(a,b,c,d,e,f,g,h){var i={imgName:b,catId:c,topText:"",bottomText:"",middleText:"",id:d,to:0,url:e,width:f,height:g},j={service:SERVICE_TYPE_MESSAGE_STICKER,body:i},k=this.getUserInfoByUsernameAndRequestToServer(a,j);k&&(i.to=k.userId,this.sendPacket(SERVICE_TYPE_MESSAGE_STICKER,i),this.addTimeout("send_message_"+d,h,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_"+d,h))},vstack.azSendMessageStickerGroup=function(a,b,c,d,e,f,g,h){var i={type:3,msgId:d,group:a,catId:c,url:e,imgName:b,width:f,height:g};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,i),this.addTimeout("send_message_group_"+d,h,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+d,h)},vstack.azSendMessageFileUrlGroup=function(a,b,c,d,e,f,g,h,i,j){var k={duration:i,fileLength:f,fileName:e,group:a,msgId:b,url:c,type:d,width:g,height:h};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,k),this.addTimeout("send_message_group_"+b,j,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+b,j)},vstack.azGetListModifiedConversations=function(a){var b={lastUpdate:a};this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS,b)},vstack.azGetListModifiedConversationsPage=function(a,b,c){var d={page:a,lastCreated:b};c&&(this.callbackId++,d.requestId=this.callbackId,this.addTimeout("getListModifiedConversationsPage_"+d.requestId,c,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("getListModifiedConversationsPage_"+d.requestId,c)),this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS,d)},vstack.azGetListModifiedMessages=function(a,b,c){var d={lastUpdate:a,type:b,chatId:c};this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_MESSAGES,d)},vstack.azGetListModifiedMessagesPage=function(a,b,c,d,e){var f={page:a,type:c,chatId:d,lastCreated:b};e&&(this.callbackId++,f.requestId=this.callbackId,this.addTimeout("getListModifiedMessagesPage_"+f.requestId,e,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("getListModifiedMessagesPage_"+f.requestId,e)),this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_MESSAGES,f)},vstack.azGetListUnreadMessages=function(a,b){var c={type:a,chatId:b};this.sendPacket(SERVICE_TYPE_LIST_UNREAD_MESSAGES,c)},vstack.azGetListUnreadMessagesPage=function(a,b,c,d){var e={page:a,type:b,chatId:c};d&&(this.callbackId++,e.requestId=this.callbackId,this.addTimeout("getListUnreadMessagesPage_"+e.requestId,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("getListUnreadMessagesPage_"+e.requestId,d)),this.sendPacket(SERVICE_TYPE_LIST_UNREAD_MESSAGES,e)},vstack.azSendTyping=function(a,b){if(1==a){var c={to:b};this.sendPacket(SERVICE_TYPE_CHAT_TYPING,c)}else if(2==a){var c={group:b};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_TYPING,c)}},vstack.requestUserInfoForPacket=function(a,b,c){this.getListUserInfoByUserIdRequestId++,this.waitingPacketByListUserId.put(this.getListUserInfoByUserIdRequestId,{service:b,body:c}),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERID,{userIdList:a.allIntKeys(),purpose:this.getListUserInfoByUserIdRequestId})},vstack.requestGroupInfoForPacket=function(a,b,c){this.getListUserInfoByUserIdRequestId++,this.waitingPacketByListUserId.put(this.getListUserInfoByUserIdRequestId,{service:b,body:c}),this.sendPacket(SERVICE_TYPE_LIST_CHAT_GROUPS_INFO,{list:a.allIntKeys(),purpose:this.getListUserInfoByUserIdRequestId})},vstack.azMakeGroup=function(a,b,c,d,e){var f={members:a,name:b,msgId:c,type:d};this.sendPacket(SERVICE_TYPE_MAKE_CHAT_GROUP,f),this.addTimeout("makeGroup_"+c,e,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("makeGroup_"+c,e)},vstack.azInviteToGroup=function(a,b,c,d){var e={members:a,group:b,msgId:c};this.sendPacket(SERVICE_TYPE_INVITE_CHAT_GROUP,e),this.addTimeout("inviteToGroup_"+c,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("inviteToGroup_"+c,d)},vstack.azLeaveGroup=function(a,b,c,d){var e={leaveUser:a,group:b,msgId:c};this.sendPacket(SERVICE_TYPE_LEAVE_CHAT_GROUP,e),this.addTimeout("leaveGroup_"+c,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("leaveGroup_"+c,d)},vstack.azRenameGroup=function(a,b,c,d){var e={name:a,group:b,msgId:c};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_RENAME,e),this.addTimeout("renameGroup_"+c,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("renameGroup_"+c,d)},vstack.azGetGroupInfo=function(a,b){var c=this.groups.get(a),d={group:a};return this.sendPacket(SERVICE_TYPE_CHAT_GROUP_INFO,d),this.addTimeout("getGroupInfo_"+a,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("getGroupInfo_"+a,b),c},vstack.azDeleteConversation=function(a,b,c,d){var e={chatId:a,type:b,lastTimeCreated:c};this.sendPacket(SERVICE_TYPE_LIST_DELETE_CONVERSATION,e),this.addTimeout("deleteConversation_"+a+"_"+b+"_"+c,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("deleteConversation_"+a+"_"+b+"_"+c,d)},vstack.azSeenMessage=function(a,b,c,d){var e={msgId:a,senderId:b,type:c,chatId:d};this.sendPacket(SERVICE_TYPE_MSG_SEEN,e)},vstack.azSeenMessages=function(a,b,c,d){var e={chatId:a,type:b,lastMsgCreated:c,list:d};this.sendPacket(SERVICE_TYPE_SEEN_MESSAGES,e)},vstack.disconnect=function(){this.appId=null,this.publicKey=null,this.azStackUserId=null,this.userCredentials=null,this.fullname=null,this.masterSocket&&this.masterSocket.disconnect instanceof Function&&this.masterSocket.disconnect(),this.slaveSocket&&this.slaveSocket.disconnect instanceof Function&&this.slaveSocket.disconnect(),this.packet_queue=new HashMap,this.send_packet_queue=new HashMap,this.users=new HashMap,this.azStackUsers=new HashMap,this.masterSocket=null,this.slaveSocket=null,this.groups=new HashMap,this.waitingPacketByListUserId=new HashMap,this.callbacks=new HashMap,this.slaveServerIp=null,this.slaveServerPort=0},vstack.azDeleteMessage=function(a,b,c,d,e){var f={msgId:a,senderId:b,chatId:c,type:d};this.sendPacket(SERVICE_TYPE_DELETE_MESSAGE,f),this.addTimeout("deleteMessage_"+b+"_"+a,e,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("deleteMessage_"+b+"_"+a,e)},vstack.azListChatGroup=function(){var a={};this.sendPacket(SERVICE_TYPE_LIST_CHAT_GROUP,a)},vstack.azChatGroupChangeAdmin=function(a,b,c,d,e){var f={group:a,newAdmin:b,msgId:c,from:d};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_CHANGE_ADMIN,f),this.addTimeout("chatGroupChangeAdmin_"+c,e,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("chatGroupChangeAdmin_"+c,e)},vstack.azListFiles=function(a){var b={lastUpdate:a};this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_FILES,b)},vstack.azApplicationChangeState=function(a){var b={state:a};this.sendPacket(SERVICE_TYPE_APPLICATION_CHANGE_STATE,b)},vstack.azChatBroadCastCreateList=function(a,b){var c={members:a,name:b};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_CREATE_LIST,c)},vstack.azChatBroadCastEditList=function(a,b,c,d,e){var f={removeUsers:a,name:b,id:c,addUsers:d,msgId:e};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_EDIT_LIST,f)},vstack.azChatBroadCastGetList=function(a){var b={lastUpdate:a};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_GET_LIST,b)},vstack.azMessageBroadCast=function(a,b,c,d){var e={broadcast:a,msg:b,msgId:c,type:0};this.sendPacket(SERVICE_TYPE_MESSAGE_BROADCAST,e),this.addTimeout("send_message_broadcast_"+c,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_broadcast_"+c,d)},vstack.azMessageStickerBroadCast=function(a,b,c,d,e,f,g,h){var i={broadcast:a,msgId:b,type:3,imgName:c,catId:d,url:e,width:f,height:g};this.sendPacket(SERVICE_TYPE_MESSAGE_BROADCAST,i),this.addTimeout("send_message_broadcast_"+b,h,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_broadcast_"+b,h)},vstack.azMessageFileBroadCast=function(a,b,c,d,e,f,g,h,i){var j={broadcast:a,msgId:b,type:c,url:d,fileName:e,fileLength:f,width:g,height:h};this.sendPacket(SERVICE_TYPE_MESSAGE_BROADCAST,j),this.addTimeout("send_message_broadcast_"+b,i,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("send_message_broadcast_"+b,i)},vstack.azChatBroadCastDeleteList=function(a){var b={broadcastId:a};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_DELETE_LIST,b)},vstack.azChatBroadCastGetMessages=function(a,b){var c={broadcastId:a,lastUpdate:b};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_GET_MESSAGES,c)},vstack.azChatGroupJoinPublic=function(a,b){var c={group:a,msgId:b};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_JOIN_PUBLIC,c)},vstack.azChatGroupGetListPublic=function(){var a={};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_GET_LIST_PUBLIC,a)},vstack.azWebRTC={iceServers:null,remoteVideo:[],localVideo:null,currentPeerConnection:null,hasVideo:!0,localCandidate:[],localSdp:null,remoteCandidate:[],remoteSdp:null,isCaller:null,localStream:null,remoteStream:[],unAddedRemoteSdp:!0,unAddedRemoteCandidate:[],currentCall:null,init:function(){if(RTCPeerConnection){var a={DtlsSrtpKeyAgreement:!0},b=null;this.iceServers&&(b={iceServers:this.iceServers});var c={optional:[a]};this.currentPeerConnection=new RTCPeerConnection(b,c),this.currentPeerConnection.onaddstream=function(a){if(0===!vstack.azWebRTC.remoteVideo.length)return void vstack.log("ERROR","remote video is empty");vstack.log("DEBUG","once remote stream arrives, show it in the remote video element");for(var b=!1,c=0;c<vstack.azWebRTC.remoteVideo.length;c++){var d=vstack.azWebRTC.remoteVideo[c];d.src||(b=!0,vstack.azWebRTC.remoteStream.push(a.stream),d.src=URL.createObjectURL(a.stream),d.onloadedmetadata=function(a){vstack.onVideoCallRemoteVideoLoaded(),d.play()})}b||vstack.log("ERROR","No video availble for binding")}}else vstack.log("ERROR","RTCPeerConnection is null")},bindVideo:function(a,b){this.localVideo=document.getElementById(a),this.localVideo||vstack.log("ERROR","Cannot attaching local video with id "+a);var c=document.getElementById(b);c?this.remoteVideo.push(c):vstack.log("ERROR","Cannot attaching remote video with id "+b)},start:function(a,b,c){if(this.isCaller=a,!this.currentPeerConnection)return void vstack.log("ERROR","currentPeerConnection is null");if(this.currentPeerConnection.onicecandidate=function(a){if(a.candidate){var d={sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,sdp:a.candidate.candidate};vstack.azWebRTC.localCandidate.push(a.candidate);var e={to:b,callId:c,type:2,data:d};vstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_DATA,e),vstack.log("DEBUG","Send any ice candidates to the other peer: "+JSON.stringify(e))}},!navigator.getUserMedia)return void vstack.log("ERROR","getUserMedia is null");var d={audio:!0,video:!1};this.hasVideo&&(d.video=!0),navigator.getUserMedia(d,function(d){function f(d){if(vstack.azWebRTC.currentPeerConnection.setLocalDescription(d),vstack.azWebRTC.localSdp=d,a)e={to:b,callId:c,sdp:d,mediaType:vstack.azWebRTC.hasVideo?2:1},vstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_INVITE,e),vstack.log("DEBUG","Start the video call: "+JSON.stringify(e));else{var e={to:b,callId:c,type:1,data:d};vstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_DATA,e),vstack.log("DEBUG","Send sdp ...: "+JSON.stringify(e))}}function g(a){vstack.log("DEBUG","Offer error: "+JSON.stringify(a))}if(vstack.log("DEBUG","Got the local steam"),vstack.azWebRTC.currentPeerConnection.addStream(d),vstack.azWebRTC.localStream=d,a)vstack.azWebRTC.currentPeerConnection.createOffer(f,g);else{if(packet={to:b,callId:c,status:200},vstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,packet),vstack.log("DEBUG","Start the video answer: "+JSON.stringify(packet)),vstack.azWebRTC.currentPeerConnection?RTCSessionDescription?(vstack.log("DEBUG","set remote sdp after call started"),vstack.azWebRTC.currentPeerConnection.setRemoteDescription(new RTCSessionDescription(vstack.azWebRTC.remoteSdp)),vstack.azWebRTC.unAddedRemoteSdp=!1):vstack.log("ERROR","RTCSessionDescription is null"):vstack.log("ERROR","currentPeerConnection is null"),vstack.azWebRTC.unAddedRemoteCandidate.length>0)if(vstack.azWebRTC.currentPeerConnection)if(RTCIceCandidate){vstack.log("DEBUG","set remote candidate after call started");for(var e=0;e<vstack.azWebRTC.unAddedRemoteCandidate.length;e++)vstack.azWebRTC.currentPeerConnection.addIceCandidate(new RTCIceCandidate(vstack.azWebRTC.unAddedRemoteCandidate[e]));vstack.azWebRTC.unAddedRemoteCandidate=[]}else vstack.log("ERROR","RTCIceCandidate is null");else vstack.log("ERROR","currentPeerConnection is null");vstack.azWebRTC.currentPeerConnection.createAnswer(f,g)}return vstack.azWebRTC.localVideo?(vstack.azWebRTC.localVideo.src=URL.createObjectURL(d),void(vstack.azWebRTC.localVideo.onloadedmetadata=function(a){vstack.onVideoCallLocalVideoLoaded(),vstack.azWebRTC.localVideo.play()})):void vstack.log("ERROR","local video is null")},function(a){vstack.log("DEBUG","getUserMedia error: "+JSON.stringify(a))})},toggleVideoState:function(a){if(!this.localStream)return void vstack.log("ERROR","Can't toggle video state, localStream is null");var b=this.localStream.getVideoTracks();if(0===b.length)return void vstack.log("ERROR","Can't toggle video state, no video stream found");if("boolean"!=typeof a){for(var c=0;c<b.length;c++)b[c].enabled=!b[c].enabled;vstack.log("DEBUG","Toggle video state done, "+(b[0].enabled?"unmuted.":"muted."))}else{for(var c=0;c<b.length;c++)b[c].enabled=a;vstack.log("DEBUG","Set video state done, "+(b[0].enabled?"unmuted.":"muted."))}},toggleAudioState:function(a){if(!this.localStream)return void vstack.log("ERROR","Can't toggle audio state, localStream is null");var b=this.localStream.getAudioTracks();if(0===b.length)return void vstack.log("ERROR","Can't toggle audio state, no audio stream found");if("boolean"!=typeof a){for(var c=0;c<b.length;c++)b[c].enabled=!b[c].enabled;vstack.log("DEBUG","Toggle audio state done, "+(b[0].enabled?"unmuted.":"muted."))}else{for(var c=0;c<b.length;c++)b[c].enabled=a;vstack.log("DEBUG","Set audio state done, "+(b[0].enabled?"unmuted.":"muted."))}},clean:function(){vstack.log("DEBUG","before clean: "+JSON.stringify(this)),this.localStream&&("undefined"==typeof this.localStream.getTracks?this.localStream.stop():this.localStream.getTracks().forEach(function(a){a.stop()})),this.localVideo&&(this.localVideo.pause(),this.localVideo.src="",this.localVideo.removeAttribute("src"));for(var a=0;a<this.remoteVideo.length;a++){var b=this.remoteVideo[a];b.pause(),b.src="",b.removeAttribute("src")}this.currentPeerConnection=null,this.localVideo=null,this.remoteVideo=[],this.hasVideo=!0,this.isCaller=null,this.localSdp=null,this.localCandidate=[],this.remoteSdp=null,this.remoteCandidate=[],this.unAddedRemoteSdp=!0,this.unAddedRemoteCandidate=[],this.localStream=null,this.remoteStream=[],this.currentCall=null,vstack.log("DEBUG","after clean: "+JSON.stringify(this))}},vstack.azStartVideoCall=function(a,b,c,d,e){this.azWebRTC.currentPeerConnection||this.azWebRTC.init(),this.azWebRTC.currentCall=b,this.azWebRTC.hasVideo=!!e,this.azWebRTC.bindVideo(c,d),this.azWebRTC.start(!0,a,b)},vstack.azAcceptVideoCall=function(a,b,c,d,e){this.azWebRTC.currentPeerConnection||this.azWebRTC.init(),this.azWebRTC.hasVideo=!!e,this.azWebRTC.bindVideo(c,d),this.azWebRTC.start(!1,a,b)},vstack.azRejectVideoCall=function(a,b){var c={to:a,callId:b,status:603};vstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,c),
vstack.log("DEBUG","Reject the video call: "+JSON.stringify(c)),this.azWebRTC.clean()},vstack.azStopVideoCall=function(a,b){var c={to:a,callId:b,status:700};vstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,c),vstack.log("DEBUG","Stop the video call: "+JSON.stringify(c)),this.azWebRTC.clean()},vstack.azNotAnsweredVideoCall=function(a,b){var c={to:a,callId:b,status:400};vstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,c),vstack.log("DEBUG","Emit the not answered video call: "+JSON.stringify(c)),this.azWebRTC.clean()},vstack.updateUserInfoWithCallBack=function(a,b){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,b),this.sendPacket(SERVICE_TYPE_USER_INFO,{userId:a,purpose:this.callbackId})},vstack.updateUserInfoByUsernameWithCallBack=function(a,b){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,b),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:[a],purpose:this.callbackId})},vstack.azGetBroadcastInfo=function(a,b){var c={id:a};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_INFO,c),this.addTimeout("getBroadcastInfo_"+a,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("getBroadcastInfo_"+a,b)},vstack.azLeaveGroupAndChangeAdmin=function(a,b,c,d,e){var f={leaveUser:a,group:c,msgId:d,newAdmin:b};this.sendPacket(SERVICE_TYPE_LEAVE_CHAT_GROUP,f),this.addTimeout("leaveGroup_"+d,e,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("leaveGroup_"+d,e)},vstack.azChargingGetBalance=function(a){this.callbackId++;var b={tmpId:this.callbackId};this.sendPacket(SERVICE_TYPE_CHARGING_GET_BALANCE,b),this.addTimeout("chargingGetBalance_"+this.callbackId,a,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("chargingGetBalance_"+this.callbackId,a)},vstack.getUserInfoByListUsernameAndRequestToServerWithCallBack=function(a,b,c){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,b);for(var d=[],e=0;e<a.length;e++){var f=a[e],g=this.azStackUsers.get(f);g&&d.push(g)}return d.length!=a.length?this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:a,purpose:this.callbackId}):(this.clearTimeout("get_user_server_"+this.callbackId),this.callCallback("get_user_server_"+this.callbackId,d)),d},vstack.getUserInfoByListUsernameAndRequestToServer=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=this.azStackUsers.get(e);f&&c.push(f)}return c.length!=a.length&&this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:a}),c},vstack.updateUserInfoByListUsernameWithCallBack=function(a,b){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,b,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,b),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:a,purpose:this.callbackId})},vstack.cancelMessage=function(a,b,c){var d={id:a,to:b,chatId:b,type:1};this.sendPacket(SERVICE_TYPE_CANCEL_MESSAGE,d),this.addTimeout("cancelMessage_"+b+"_"+a,c,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("cancelMessage_"+b+"_"+a,c)},vstack.groupCancelMessage=function(a,b,c){var d={msgId:a,group:b,chatId:b,type:2};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_CANCEL_MESSAGE,d),this.addTimeout("groupCancelMessage_"+b+"_"+a,c,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("groupCancelMessage_"+b+"_"+a,c)},vstack.joinExternal=function(a,b,c,d){var e={groupId:a,msgId:b,token:c};this.sendPacket(SERVICE_TYPE_JOIN_EXTERNAL_CHAT_GROUP,e),this.addTimeout("joinExternal_"+a+"_"+b,d,{r:-1},vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected?vstack.callbackTimeoutTime:0),this.addCallback("joinExternal_"+a+"_"+b,d)},vstack.azMakeConferenceRoom=function(a,b,c){this.callbackId++;var d={userType:a,roomType:b,requestId:this.callbackId};this.addCallback("make_conference_room_"+this.callbackId,c),this.sendPacket(SERVICE_TYPE_CONFERENCE_MAKE_ROOM,d)},vstack.azJoinConferenceRoom=function(a,b){this.callbackId++;var c={requestId:this.callbackId,roomId:a};this.addCallback("join_conference_room_"+this.callbackId,b),this.sendPacket(SERVICE_TYPE_CONFERENCE_JOIN_ROOM,c)},vstack.startVideoConference=function(a,b,c,d,e){vstack.azVideoConference.roomToken=a,vstack.azVideoConference.currentRooomId=b,vstack.azVideoConference.parentId=e,vstack.azVideoConference.start(c,d)},vstack.azVideoConference={currentRooomId:0,roomToken:"",localStream:null,remoteStreams:new HashMap,room:null,mainShowElementId:null,isAdmin:!1,isPickup:!1,displayStreams:[],maxVideoBW:500,parentId:"",start:function(a,b){console.log("start video conference, isAdmin: "+a),vstack.azVideoConference.isAdmin=a;var c={audio:!0,video:b,data:!0,screen:!1,videoSize:[640,480,640,480],attributes:{admin:a}};vstack.azVideoConference.localStream=Erizo.Stream(c),vstack.azVideoConference.room=Erizo.Room({token:this.roomToken}),vstack.azVideoConference.localStream.addEventListener("access-accepted",function(){var a=function(a){for(var b in a){var c=a[b];vstack.azVideoConference.localStream.getID()!==c.getID()&&(c.hasVideo()?vstack.azVideoConference.room.subscribe(c,{audio:!0,video:!0}):vstack.azVideoConference.room.subscribe(c,{audio:!0,video:!1}),vstack.azVideoConference.remoteStreams.put(c.getID(),c))}};vstack.azVideoConference.room.addEventListener("room-connected",function(b){vstack.azVideoConference.room.publish(vstack.azVideoConference.localStream,{maxVideoBW:vstack.azVideoConference.maxVideoBW}),a(b.streams)}),vstack.azVideoConference.room.addEventListener("stream-subscribed",function(a){var b=a.stream,c=document.createElement("div");c.setAttribute("class","video-i"),c.setAttribute("id","stream_"+b.getID());var d=document.getElementById("call-wrapper");d.appendChild(c),b.show("stream_"+b.getID()),vstack.azVideoConference.drawLayout()}),vstack.azVideoConference.room.addEventListener("stream-added",function(b){var c=[];c.push(b.stream),a(c)}),vstack.azVideoConference.room.addEventListener("stream-removed",function(a){var b=a.stream;if(console.log("remove remoteVideo, elementId: "+b.elementID),vstack.azVideoConference.remoteStreams.remove(b.getID()),void 0!==b.elementID){var c=document.getElementById(b.elementID),d=document.getElementById("call-wrapper");d.removeChild(c)}vstack.azVideoConference.drawLayout()}),vstack.azVideoConference.room.addEventListener("stream-failed",function(a){console.log("Stream Failed, act accordingly")}),vstack.azVideoConference.room.connect(),vstack.azVideoConference.localStream.show("local-video"),vstack.azVideoConference.drawLayout()}),vstack.azVideoConference.localStream.init()},calcLayout:function(a,b,c){var f,g,h,i,d=4/3,e=[];switch(c){case 1:f={left:0,top:0,width:a,height:b,main:1},e.push(f);break;case 2:a>=b?(f={left:0,top:0,width:a/2,height:b,main:1},g={left:a/2,top:0,width:a/2,height:b,main:0}):(f={left:0,top:0,width:a,height:b/2,main:1},g={left:0,top:b/2,width:a,height:b/2,main:0}),e.push(f),e.push(g);break;case 3:a>=b?(f={left:0,top:0,width:2*a/3,height:b,main:1},g={left:2*a/3,top:0,width:a/3,height:b/2,main:0},h={left:2*a/3,top:b/2,width:a/3,height:b/2,main:0}):(f={left:0,top:0,width:a,height:2*b/3,main:1},g={left:0,top:2*b/3,width:a/2,height:b/3,main:0},h={left:a/2,top:2*b/3,width:a/2,height:b/3,main:0}),e.push(f),e.push(g),e.push(h);break;case 4:f={left:0,top:0,width:a/2,height:b/2,main:1},g={left:a/2,top:0,width:a/2,height:b/2,main:0},h={left:0,top:b/2,width:a/2,height:b/2,main:0},i={left:a/2,top:b/2,width:a/2,height:b/2,main:0},e.push(f),e.push(g),e.push(h),e.push(i);break;default:f={left:0,top:0,width:a,height:3*b/4,main:1},e.push(f);for(var j=b/4,k=j*d,l=k*(c-1),m=(a-l)/2,n=3*b/4,o=0;o<c-1;o++){var p=m+k*o,q={left:p,top:n,width:k,height:j,main:0};e.push(q)}}return e},drawLayout:function(){var a=$("#"+vstack.azVideoConference.parentId),b=vstack.azVideoConference.remoteStreams.length+1,c=vstack.azVideoConference.calcLayout(a.width(),a.height(),b);if(console.log("+++ draw layout: "+JSON.stringify(c)),void 0!=vstack.azVideoConference.localStream&&null!=vstack.azVideoConference.localStream){var d=c[0],e=$("#"+vstack.azVideoConference.localStream.elementID);e.css({left:d.left,top:d.top,width:d.width,height:d.height}),void 0!==vstack.azVideoConference.localStream.player&&null!==vstack.azVideoConference.localStream.player}if(console.log("+++ draw layout: "+b),b>1)for(var f=vstack.azVideoConference.remoteStreams.allValues(),g=0;g<b-1;g++){var h=f[g],i=$("#"+h.elementID),j=c[g+1];console.log("draw layer i: "+JSON.stringify(j)),i.css({left:j.left,top:j.top,width:j.width,height:j.height}),console.log(h.player)}}},vstack.ping_processor=function(a,b){this.sendPacket(SERVICE_TYPE_PING,{})},vstack.get_server_addr_processor=function(a,b){vstack.log("DEBUG","get_server_addr_processor"),vstack.log("DEBUG",b),this.slaveServerIp=b.ip,this.slaveServerPort=b.port,vstack.log("DEBUG","this.slaveServerIp: "+this.slaveServerIp),vstack.log("DEBUG","this.slaveServerPort: "+this.slaveServerPort),this.masterSocket.disconnect(),this.slaveSocket=io.connect(this.chatProxyServer,{resource:"B/socket.io","force new connection":!0}),this.slaveSocket.io.reconnection(!1),this.slaveSocket.on("connect",function(){vstack.log("INFO","Client has connected to the SlaveServer!"),vstack.internalAuthentication()}),this.slaveSocket.on("WebPacket",function(a){var b;b=a.body.length>0?JSON.parse(a.body):{},vstack.packetReceived(a.service,b)}),this.slaveSocket.on("disconnect",function(){vstack.log("INFO","The client has disconnected with SlaveServer!");var a=function(){if(!vstack.reConnecting&&vstack.appId&&vstack.publicKey&&vstack.azStackUserId){vstack.reConnecting=!0,vstack.connect(vstack.appId,vstack.publicKey,vstack.azStackUserId,vstack.userCredentials,vstack.fullname);var b=setInterval(function(){clearInterval(b),setTimeout(function(){vstack.reConnecting=!1,vstack&&vstack.slaveSocket&&vstack.slaveSocket.connected||a()},vstack.slaveSocket.io.timeout())},500)}};a()})},vstack.internalAuthentication=function(){var a={namespace:this.namespace,sdkVersion:this.sdkVersion,azStackUserID:this.azStackUserId,userCredentials:this.userCredentials},b=new JSEncrypt;b.setPublicKey(this.publicKey);var c=b.encrypt(JSON.stringify(a));if(!c)return void console.log("Could not encrypt authenStringPlaintext, please check your public key");vstack.log("DEBUG","send authen packet to SlaveServer");var d={slaveIp:this.slaveServerIp,slavePort:this.slaveServerPort,token:c,fullname:this.fullname,namespace:this.namespace,appId:this.appId,platform:3,sdkVersion:this.sdkVersion,screenSize:window.screen.width+"x"+window.screen.height},e=this.getCookie("sessionToken"),f=this.getCookie("sessionId");""!=e&&(d.sessionToken=e),""!=f&&(d.sessionId=f),this.sendPacket(SERVICE_TYPE_AUTHENTICATION_2_STEP,d)},vstack.authentication_processor=function(a,b){if(1==b.resultCode){this.azWebRTC.iceServers=[];for(var c=0;c<b.ice_server.length;c++)this.azWebRTC.iceServers.push({url:b.ice_server[c].url?b.ice_server[c].url:"",username:b.ice_server[c].username?b.ice_server[c].username:"",credential:b.ice_server[c].password?b.ice_server[c].password:""})}b.sessionToken&&""==this.getCookie("sessionToken")&&this.setCookie("sessionToken",b.sessionToken,365),b.sessionId&&""==this.getCookie("sessionId")&&this.setCookie("sessionId",b.sessionId,365);var d={fullname:b.fullname,azStackUserId:b.username,userId:b.userId,namespace:this.namespace};this.onAuthenticationCompleted(b.resultCode,d,b.resultMsg)},vstack.messageProcessor=function(a,b){var c=this.getUserInfoAndRequestToServer(b.from,{service:a,body:b});return c?(b.from=c,b.type=1,this.onMessagesSent(b),this.clearTimeout("send_message_"+b.msgId),void this.callCallback("send_message_"+b.msgId,b)):void vstack.log("DEBUG","messageProcessor chua co info, gui yeu cau len server lay info")},vstack.messageReportProcessor=function(a,b){var c={msgIds:[b.msgId],from:b.from,type:1,chatId:b.from,modified:b.time};this.deliveredMessagesProcessor(a,c)},vstack.messageGroupProcessor=function(a,b){var c=b.group,d=this.groups.get(c);if(!d){var e=new HashMap;return e.put(c,1),void this.requestGroupInfoForPacket(e,a,b)}b.group=d,b.type=2,this.onMessagesSent(b),this.clearTimeout("send_message_group_"+b.msgId),this.callCallback("send_message_group_"+b.msgId,b)},vstack.messageReportGroupProcessor=function(a,b){var c={msgIds:[b.msgId],from:b.from,type:2,chatId:b.group,modified:b.modified};this.deliveredMessagesProcessor(a,c)},vstack.deliveredMessagesProcessor=function(a,b){if(a=SERVICE_TYPE_DELIVERED_MESSAGES,delete b.senderId,!this.users.get(b.from)){var c=new HashMap;return c.put(b.from,1),void this.requestUserInfoForPacket(c,a,b)}if(b.from=this.users.get(b.from),1==b.type)delete b.chatId;else if(2==b.type){var d=b.chatId,e=this.groups.get(d);if(!e){var f=new HashMap;return f.put(d,1),void this.requestGroupInfoForPacket(f,a,b)}b.group=e}this.onMessagesDelivered(b)},vstack.have_message_processor=function(a,b){var c=this.getUserInfoAndRequestToServer(b.from,{service:a,body:b});if(c){var d={msgId:b.msgId,msg:b.msg,type:0,time:b.time};this.users.get(c.userId)&&(this.users.get(c.userId).status=1),this.azStackUsers.get(c.azStackUserID)&&(this.azStackUsers.get(c.azStackUserID).status=1),this.onMessageReceived(c,d)}},vstack.haveMessageStickerProcessor=function(a,b){var c=this.getUserInfoAndRequestToServer(b.from,{service:a,body:b});if(c){var d={width:b.width,height:b.height,url:b.url,catId:b.catId,imgName:b.imgName,msgId:b.id,msg:b.msg,type:3,time:b.created};this.users.get(c.userId)&&(this.users.get(c.userId).status=1),this.azStackUsers.get(c.azStackUserID)&&(this.azStackUsers.get(c.azStackUserID).status=1),this.onMessageReceived(c,d)}},vstack.have_message_file_url_processor=function(a,b){var c=this.getUserInfoAndRequestToServer(b.from,{service:a,body:b});if(c){var d={width:b.width,height:b.height,msgId:b.id,msg:b.msg,type:b.type,url:b.url,time:b.created,fileName:b.fileName,fileLength:b.fileLength,duration:b.duration};this.users.get(c.userId)&&(this.users.get(c.userId).status=1),this.azStackUsers.get(c.azStackUserID)&&(this.azStackUsers.get(c.azStackUserID).status=1),this.onMessageReceived(c,d)}},vstack.have_message_location_processor=function(a,b){var c=this.getUserInfoAndRequestToServer(b.from,{service:a,body:b});c&&(this.users.get(c.userId)&&(this.users.get(c.userId).status=1),this.azStackUsers.get(c.azStackUserID)&&(this.azStackUsers.get(c.azStackUserID).status=1),this.onMessageReceived(c,b))},vstack.haveMessageGroupProcessor=function(a,b){if(!this.users.get(b.from)){var c=new HashMap;return c.put(b.from,1),void this.requestUserInfoForPacket(c,a,b)}b.from=this.users.get(b.from);var d=this.groups.get(b.group);if(!d){var e=new HashMap;return e.put(b.group,1),void this.requestGroupInfoForPacket(e,a,b)}b.group=d,this.users.get(b.from.userId)&&(this.users.get(b.from.userId).status=1),this.azStackUsers.get(b.from.azStackUserID)&&(this.azStackUsers.get(b.from.azStackUserID).status=1),this.onGroupMessageReceived(b)},vstack.chat_typing_processor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),vstack.log("INFO","chat typing from: "+b.from)},vstack.chat_group_typing_processor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),vstack.log("INFO","chat group typing from: "+b.from+", to group: "+b.group)},vstack.user_info_processor=function(a,b){vstack.log("DEBUG","user_info_processor, azStackUserID: "+b.username+", userId: "+b.userId),b.username||this.onListModifiedConversationDeleted({list:[{type:1,chatId:b.userId,deleted:1}],done:1}),this.clearTimeout("get_user_server_"+b.purpose),this.callCallback("get_user_server_"+b.purpose,[b]),this.cacheUserInfo(b);var c=this.packet_queue.get(b.userId);if(c)for(;c.length>0;){var d=c.pop();void 0!=d&&this.packetReceived(d.service,d.body)}},vstack.user_info_by_username_processor=function(a,b){var c=b.userInfoList;for(this.clearTimeout("get_user_server_"+b.purpose),this.callCallback("get_user_server_"+b.purpose,b.userInfoList);c.length>0;){var d=c.pop();vstack.log("DEBUG","user_info_by_username from server, azStackUserID: "+d.username+", userId: "+d.userId),d.username||this.onListModifiedConversationDeleted({list:[{type:1,chatId:d.userId,deleted:1}],done:1}),this.cacheUserInfo(d);var e=this.send_packet_queue.get(d.username);if(e)for(;e.length>0;){var f=e.pop();if(void 0!=f&&(f.service==SERVICE_TYPE_MESSAGE2||f.service==SERVICE_TYPE_MESSAGE_FILE_URL||f.service==SERVICE_TYPE_MESSAGE_STICKER)){if(!d.userId){vstack.log("DEBUG","khong gui dc tin nhan vi user nay chua ton tai");continue}f.body.to=d.userId,this.sendPacket(f.service,f.body),vstack.log("DEBUG","Gui bu packet dang cho` trong queue"),vstack.log("DEBUG",f)}}}},vstack.getListUserInfoByListUserIDsProcessor=function(a,b){for(;b.userInfoList.length>0;){var c=b.userInfoList.pop();this.cacheUserInfo(c)}var d=this.waitingPacketByListUserId.get(b.purpose);d&&(this.waitingPacketByListUserId.remove(b.purpose),this.packetReceived(d.service,d.body))},vstack.getListGroupInfoProcessor=function(a,b){for(;b.listGroups.length>0;){var c=b.listGroups.pop();this.groups.put(c.id,c)}var d=this.waitingPacketByListUserId.get(b.purpose);d&&(this.waitingPacketByListUserId.remove(b.purpose),this.packetReceived(d.service,d.body))},vstack.getListGroupInfoMoreProcessor=function(a,b){this.addMemberGroupInfo(b)},vstack.get_list_modified_conversations_processor=function(a,b){for(var c=new HashMap,d=new HashMap,e=0;e<b.list.length;e++){var f=b.list[e];if(delete f.ownerId,void 0!=f.lastMsg&&(f.lastMsg.sender instanceof Object&&(f.lastMsg.sender=f.lastMsg.sender.userId),this.users.get(f.lastMsg.sender)?f.lastMsg.sender=this.users.get(f.lastMsg.sender):c.put(f.lastMsg.sender,1)),1==f.type)this.users.get(f.chatId)?f.chatTarget=this.users.get(f.chatId):c.put(f.chatId,1);else if(2==f.type){var g=this.groups.get(f.chatId);g?f.chatTarget=g:d.put(f.chatId,1)}}return d.size()>0?void this.requestGroupInfoForPacket(d,a,b):c.size()>0?void this.requestUserInfoForPacket(c,a,b):(this.onListModifiedConversationReceived(b),void(b.requestId&&(this.clearTimeout("getListModifiedConversationsPage_"+b.requestId),this.callCallback("getListModifiedConversationsPage_"+b.requestId,b))))},vstack.get_list_modified_messages_processor=function(a,b){for(var c=new HashMap,d=0;d<b.list.length;d++){var e=b.list[d];this.users.get(e.receiverId)?e.receiver=this.users.get(e.receiverId):c.put(e.receiverId,1),this.users.get(e.senderId)?e.sender=this.users.get(e.senderId):c.put(e.senderId,1)}return c.size()>0?void this.requestUserInfoForPacket(c,a,b):(this.onListModifiedMessagesReceived(b),void(b.requestId&&(this.clearTimeout("getListModifiedMessagesPage_"+b.requestId),this.callCallback("getListModifiedMessagesPage_"+b.requestId,b))))},vstack.get_list_unread_messages_processor=function(a,b){for(var c=new HashMap,d=0;d<b.list.length;d++){var e=b.list[d];this.users.get(e.receiverId)?e.receiver=this.users.get(e.receiverId):c.put(e.receiverId,1),this.users.get(e.senderId)?e.sender=this.users.get(e.senderId):c.put(e.senderId,1)}return c.size()>0?void this.requestUserInfoForPacket(c,a,b):(this.onListUnreadMessagesReceived(b),void(b.requestId&&(this.clearTimeout("getListUnreadMessagesPage_"+b.requestId),this.callCallback("getListUnreadMessagesPage_"+b.requestId,b))))},vstack.haveMsgFromMeProcessor=function(a,b){if(!this.users.get(b.to)){var c=new HashMap;return c.put(b.to,1),void this.requestUserInfoForPacket(c,a,b)}b.to=this.users.get(b.to),b.chatType=1,this.onMessageFromMe(b)},vstack.haveMsgGroupFromMeProcessor=function(a,b){var c=this.groups.get(b.group);if(!c){var d=new HashMap;return d.put(b.group,1),void this.requestGroupInfoForPacket(d,a,b)}b.group=c,b.chatType=2,delete b.from,this.onMessageFromMe(b)},vstack.makeGroupProcessor=function(a,b){this.clearTimeout("makeGroup_"+b.msgId),this.callCallback("makeGroup_"+b.msgId,b)},vstack.inviteToGroupProcessor=function(a,b){this.clearTimeout("inviteToGroup_"+b.msgId),this.callCallback("inviteToGroup_"+b.msgId,b)},vstack.leaveGroupProcessor=function(a,b){this.clearTimeout("leaveGroup_"+b.msgId),this.callCallback("leaveGroup_"+b.msgId,b)},vstack.renameGroupProcessor=function(a,b){this.clearTimeout("renameGroup_"+b.msgId),this.callCallback("renameGroup_"+b.msgId,b)},vstack.applicationChangeStateProcessor=function(a,b){this.onApplicationChangeState(b)},vstack.getGroupInfoProcessor=function(a,b){0==b.r?this.cacheGroupInfo(b):this.onListModifiedConversationDeleted({list:[{type:2,chatId:b.group,deleted:1}],done:1}),this.clearTimeout("getGroupInfo_"+b.group),this.callCallback("getGroupInfo_"+b.group,b)},vstack.getBroadcastInfoProcessor=function(a,b){0!=b.r&&this.onListModifiedConversationDeleted({list:[{type:2,chatId:b.id,deleted:1}],done:1}),this.clearTimeout("getBroadcastInfo_"+b.id),this.callCallback("getBroadcastInfo_"+b.id,b)},vstack.makeGroupNotificationProcessor=function(a,b){this.users.get(b.admin)&&(this.users.get(b.admin).status=1,this.azStackUsers.get(this.users.get(b.admin).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.admin).azStackUserID).status=1)),this.onMakeGroupNotification(b)},vstack.inviteToGroupNotificationProcessor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),this.onInviteGroupNotification(b)},vstack.leaveGroupNotificationProcessor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),this.groups.get(b.group)&&b.admin&&(this.groups.get(b.group).admin=b.admin),this.onLeaveGroupNotification(b)},vstack.renameGroupNotificationProcessor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),this.groups.get(b.group)&&b.name&&(this.groups.get(b.group).name=b.name),this.onRenameGroupNotification(b)},vstack.deleteConversationProcessor=function(a,b){this.clearTimeout("deleteConversation_"+b.chatId+"_"+b.type+"_"+b.lastTimeCreated),this.callCallback("deleteConversation_"+b.chatId+"_"+b.type+"_"+b.lastTimeCreated,b),this.onDeleteConversation(b)},vstack.seenMessageProcessor=function(a,b){this.onSeenMessage(b)},vstack.seenMessagesProcessor=function(a,b){this.onSeenMessages(b)},vstack.deleteMessageProcessor=function(a,b){this.clearTimeout("deleteMessage_"+b.senderId+"_"+b.msgId),this.callCallback("deleteMessage_"+b.senderId+"_"+b.msgId,b)},vstack.listChatGroupProcessor=function(a,b){this.onListChatGroup(b)},vstack.chatGroupChangeAdminProcessor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),this.groups.get(b.group)&&b.newAdmin&&(this.groups.get(b.group).admin=b.newAdmin),this.clearTimeout("chatGroupChangeAdmin_"+b.msgId),this.callCallback("chatGroupChangeAdmin_"+b.msgId,b),this.onChatGroupChangeAdmin(b)},vstack.chatListFilesProcessor=function(a,b){for(var c=new HashMap,d=0;d<b.list.length;d++){var e=b.list[d];this.users.get(e.receiverId)?e.receiver=this.users.get(e.receiverId):c.put(e.receiverId,1),this.users.get(e.senderId)?e.sender=this.users.get(e.senderId):c.put(e.senderId,1)}return c.size()>0?void this.requestUserInfoForPacket(c,a,b):void this.onListFilesReceived(b)},vstack.chatBroadCastCreateListProcessor=function(a,b){this.onBroadCastCreateList(b)},vstack.chatBroadCastEditListProcessor=function(a,b){this.onBroadCastEditList(b)},vstack.chatBroadCastGetListProcessor=function(a,b){this.onBroadCastGetList(b)},vstack.messageBroadCastProcessor=function(a,b){this.onMessageBroadCast(b),this.clearTimeout("send_message_broadcast_"+b.msgId),this.callCallback("send_message_broadcast_"+b.msgId,b)},vstack.haveMessageBroadCastProcessor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),this.onHaveMessageBroadCast(b)},vstack.chatBroadCastDeleteListProcessor=function(a,b){this.onChatBroadCastDeleteList(b)},vstack.chatBroadCastGetMessagesProcessor=function(a,b){this.onChatBroadCastGetMessages(b)},vstack.chatGroupJoinPublicProcessor=function(a,b){this.onChatGroupJoinPublic(b)},vstack.chatGroupGetListPublicProcessor=function(a,b){this.onChatGroupGetListPublic(b)},vstack.inviteVideoCallProcessor=function(a,b){if(this.azWebRTC.currentCall){var c={to:b.from,callId:b.callId,status:600};this.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,c),vstack.log("DEBUG","response busy to other call when being on a call")}else{var c={to:b.from,callId:b.callId,status:180};this.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,c),this.azWebRTC.currentCall=b.callId,this.azWebRTC.remoteSdp=b.sdp,b.hasVideo=2===b.mediaType,this.onInviteVideoCall(b)}},vstack.dataVideoCallProcessor=function(a,b){if(this.azWebRTC.currentCall)if(1==b.type){if(this.azWebRTC.remoteSdp=b.data,vstack.log("DEBUG","Video call received sdp: "+JSON.stringify(b)),this.azWebRTC.isCaller){if(!this.azWebRTC.currentPeerConnection)return void vstack.log("ERROR","currentPeerConnection is null");if(!RTCSessionDescription)return void vstack.log("ERROR","RTCSessionDescription is null");if(vstack.log("DEBUG","set remote sdp in event"),this.azWebRTC.currentPeerConnection.setRemoteDescription(new RTCSessionDescription(this.azWebRTC.remoteSdp)),this.azWebRTC.unAddedRemoteSdp=!1,this.azWebRTC.unAddedRemoteCandidate.length>0)if(this.azWebRTC.currentPeerConnection)if(RTCIceCandidate){vstack.log("DEBUG","set remote candidate after receive sdp");for(var c=0;c<this.azWebRTC.unAddedRemoteCandidate.length;c++)this.azWebRTC.currentPeerConnection.addIceCandidate(new RTCIceCandidate(this.azWebRTC.unAddedRemoteCandidate[c]));this.azWebRTC.unAddedRemoteCandidate=[]}else vstack.log("ERROR","RTCIceCandidate is null");else vstack.log("ERROR","currentPeerConnection is null")}}else if(2==b.type){var d={candidate:b.data.sdp,sdpMid:b.data.sdpMid,sdpMLineIndex:b.data.sdpMLineIndex};if(this.azWebRTC.remoteCandidate.push(d),vstack.log("DEBUG","Video call receive candidate: "+JSON.stringify(b)),this.azWebRTC.unAddedRemoteSdp)this.azWebRTC.unAddedRemoteCandidate.push(d);else{if(!this.azWebRTC.currentPeerConnection)return void vstack.log("ERROR","currentPeerConnection is null");if(!RTCIceCandidate)return void vstack.log("ERROR","RTCIceCandidate is null");vstack.log("DEBUG","set remote candidate in event"),this.azWebRTC.currentPeerConnection.addIceCandidate(new RTCIceCandidate(d))}}},vstack.statusVideoCallProcessor=function(a,b){if(this.azWebRTC.currentCall&&this.azWebRTC.currentCall!=b.callId)return void vstack.log("ignore other call's packet when being in a call");switch(b.status){case 100:this.azWebRTC.currentCall&&this.onVideoCallConnecting(b);break;case 180:this.azWebRTC.currentCall&&this.onVideoCallRinging(b);break;case 200:this.azWebRTC.currentCall&&this.onVideoCallAnswered(b);break;case 600:this.azWebRTC.currentCall&&(this.azWebRTC.clean(),this.onVideoCallBusy(b));break;case 603:this.azWebRTC.currentCall&&(this.azWebRTC.clean(),this.onVideoCallRejected(b));break;case 700:this.azWebRTC.currentCall&&(this.azWebRTC.clean(),this.onVideoCallStop(b));break;case 400:this.azWebRTC.clean(),this.onVideoCallNotAnswered(b);break;default:this.azWebRTC.clean(),this.onVideoCallError(b)}},vstack.statusVideoCallByMeProcessor=function(a,b){switch(b.status){case 200:this.azWebRTC.clean(),this.onVideoCallAnsweredByMe(b);break;case 600:this.azWebRTC.clean(),this.onVideoCallBusyByMe(b);break;case 603:this.azWebRTC.clean(),this.onVideoCallRejectedByMe(b);break;case 700:this.azWebRTC.clean(),this.onVideoCallStopByMe(b);break;case 400:this.azWebRTC.clean(),this.onVideoCallNotAnsweredByMe(b);break;default:this.azWebRTC.clean(),this.onVideoCallErrorByMe(b)}},vstack.chargingGetBalanceProcessor=function(a,b){0==b.r&&this.azStackUsers.get(this.azStackUserId)&&(this.azStackUsers.get(this.azStackUserId).balance=b.balance,this.users.get(this.azStackUsers.get(this.azStackUserId).userId)&&(this.users.get(this.azStackUsers.get(this.azStackUserId).userId).balance=b.balance)),this.clearTimeout("chargingGetBalance_"+b.tmpId),this.callCallback("chargingGetBalance_"+b.tmpId,b)},vstack.cancelMessageProcessor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),this.onCancelMessage(b)},vstack.groupCancelMessageProcessor=function(a,b){this.users.get(b.from)&&(this.users.get(b.from).status=1,this.azStackUsers.get(this.users.get(b.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(b.from).azStackUserID).status=1)),this.onGroupCancelMessage(b)},vstack.logout=function(){vstack.disconnect(),this.setCookie("sessionToken","",365),this.setCookie("sessionId","",365)},vstack.joinExternalProcessor=function(a,b){this.clearTimeout("joinExternal_"+b.groupId+"_"+b.msgId),this.callCallback("joinExternal_"+b.groupId+"_"+b.msgId,b),this.onJoinExternal(b)},vstack.joinExternalNotificationProcessor=function(a,b){this.onJoinExternalNotification(b)},vstack.conferenceMakeRoomProcessor=function(a,b){this.callCallback("make_conference_room_"+b.requestId,b),this.onConferenceMakeRoom(b)},vstack.conferenceJoinRoomProcessor=function(a,b){this.callCallback("join_conference_room_"+b.requestId,b),this.onConferenceJoinRoom(b)},vstack.onAuthenticationCompleted=function(a,b){vstack.log("ERROR","please implement method: azAuthentication")},vstack.onMessageReceived=function(a,b){vstack.log("ERROR","please implement method: azHaveMessage")},vstack.onGroupMessageReceived=function(a){vstack.log("ERROR","please implement method: onGroupMessageReceived"),vstack.log("INFO","onGroupMessageReceived: "+a)},vstack.onListModifiedConversationReceived=function(a){vstack.log("ERROR","please implement method: azHaveMessage")},vstack.onListModifiedMessagesReceived=function(a){vstack.log("ERROR","please implement method: onListModifiedMessagesReceived")},vstack.onListUnreadMessagesReceived=function(a){vstack.log("ERROR","please implement method: onListUnreadMessagesReceived")},vstack.onMessagesDelivered=function(a){vstack.log("ERROR","please implement method: onMessagesDelivered")},vstack.onMessagesSent=function(a){vstack.log("ERROR","please implement method: onMessagesSent")},vstack.onMessageFromMe=function(a){vstack.log("ERROR","please implement method: onMessageFromMe")},vstack.onMakeGroupNotification=function(a){vstack.log("ERROR","please implement method: onMakeGroupNotification")},vstack.onInviteGroupNotification=function(a){vstack.log("ERROR","please implement method: onInviteGroupNotification")},vstack.onLeaveGroupNotification=function(a){vstack.log("ERROR","please implement method: onLeaveGroupNotification")},vstack.onRenameGroupNotification=function(a){vstack.log("ERROR","please implement method: onRenameGroupNotification");
},vstack.onDeleteConversation=function(a){vstack.log("ERROR","please implement method: onDeleteConversation")},vstack.onSeenMessage=function(a){vstack.log("ERROR","please implement method: onSeenMessage")},vstack.onSeenMessages=function(a){vstack.log("ERROR","please implement method: onSeenMessages")},vstack.onDeleteMessage=function(a){vstack.log("INFO","please implement method: onDeleteMessage")},vstack.onListChatGroup=function(a){vstack.log("INFO","please implement method: onListChatGroup, packet: "+JSON.stringify(a))},vstack.onChatGroupChangeAdmin=function(a){vstack.log("INFO","please implement method: onChatGroupChangeAdmin, packet: "+JSON.stringify(a))},vstack.onListFilesReceived=function(a){vstack.log("INFO","please implement method: onListFiles, packet: "+JSON.stringify(a))},vstack.onApplicationChangeState=function(a){vstack.log("INFO","please implement method: onApplicationChangeState, packet: "+JSON.stringify(a))},vstack.onBroadCastCreateList=function(a){vstack.log("INFO","please implement method: onBroadCastCreateList, packet: "+JSON.stringify(a))},vstack.onBroadCastEditList=function(a){vstack.log("INFO","please implement method: onBroadCastEditList, packet: "+JSON.stringify(a))},vstack.onBroadCastGetList=function(a){vstack.log("INFO","please implement method: onBroadCastGetList, packet: "+JSON.stringify(a))},vstack.onMessageBroadCast=function(a){vstack.log("INFO","please implement method: onMessageBroadCast, packet: "+JSON.stringify(a))},vstack.onHaveMessageBroadCast=function(a){vstack.log("INFO","please implement method: onHaveMessageBroadCast, packet: "+JSON.stringify(a))},vstack.onChatBroadCastDeleteList=function(a){vstack.log("INFO","please implement method: onChatBroadCastDeleteList, packet: "+JSON.stringify(a))},vstack.onChatBroadCastGetMessages=function(a){vstack.log("INFO","please implement method: onChatBroadCastGetMessages, packet: "+JSON.stringify(a))},vstack.onChatGroupJoinPublic=function(a){vstack.log("INFO","please implement method: onChatGroupJoinPublic, packet: "+JSON.stringify(a))},vstack.onChatGroupGetListPublic=function(a){vstack.log("INFO","please implement method: onChatGroupGetListPublic, packet: "+JSON.stringify(a))},vstack.onInviteVideoCall=function(a){vstack.log("INFO","please implement method: onInviteVideoCall, packet: "+JSON.stringify(a))},vstack.onVideoCallConnecting=function(a){vstack.log("INFO","please implement method: onVideoCallConnecting, packet: "+JSON.stringify(a))},vstack.onVideoCallRinging=function(a){vstack.log("INFO","please implement method: onVideoCallRinging, packet: "+JSON.stringify(a))},vstack.onVideoCallAnswered=function(a){vstack.log("INFO","please implement method: onVideoCallAnswered, packet: "+JSON.stringify(a))},vstack.onVideoCallBusy=function(a){vstack.log("INFO","please implement method: onVideoCallBusy, packet: "+JSON.stringify(a))},vstack.onVideoCallRejected=function(a){vstack.log("INFO","please implement method: onVideoCallRejected, packet: "+JSON.stringify(a))},vstack.onVideoCallStop=function(a){vstack.log("INFO","please implement method: onVideoCallStop, packet: "+JSON.stringify(a))},vstack.onVideoCallNotAnswered=function(a){vstack.log("INFO","please implement method: onVideoCallNotAnswered, packet: "+JSON.stringify(a))},vstack.onVideoCallError=function(a){vstack.log("INFO","please implement method: onVideoCallError, packet: "+JSON.stringify(a))},vstack.onVideoCallLocalVideoLoaded=function(){vstack.log("INFO","please implement method: onVideoCallLocalVideoLoaded")},vstack.onVideoCallRemoteVideoLoaded=function(){vstack.log("INFO","please implement method: onVideoCallRemoteVideoLoaded")},vstack.onVideoCallBusyByMe=function(a){vstack.log("INFO","please implement method: onVideoCallBusyByMe, packet: "+JSON.stringify(a))},vstack.onVideoCallAnsweredByMe=function(a){vstack.log("INFO","please implement method: onVideoCallAnsweredByMe, packet: "+JSON.stringify(a))},vstack.onVideoCallRejectedByMe=function(a){vstack.log("INFO","please implement method: onVideoCallRejectedByMe, packet: "+JSON.stringify(a))},vstack.onVideoCallStopByMe=function(a){vstack.log("INFO","please implement method: onVideoCallStopByMe, packet: "+JSON.stringify(a))},vstack.onVideoCallNotAnsweredByMe=function(a){vstack.log("INFO","please implement method: onVideoCallNotAnsweredByMe, packet: "+JSON.stringify(a))},vstack.onVideoCallErrorByMe=function(a){vstack.log("INFO","please implement method: onVideoCallErrorByMe, packet: "+JSON.stringify(a))},vstack.onListModifiedConversationDeleted=function(a){vstack.log("INFO","please implement method: onListModifiedConversationDeleted, packet: "+JSON.stringify(a))},vstack.onJoinExternal=function(a){vstack.log("INFO","please implement method: onJoinExternal, packet: "+JSON.stringify(a))},vstack.onJoinExternalNotification=function(a){vstack.log("INFO","please implement method: onJoinExternalNotification, packet: "+JSON.stringify(a))},vstack.onConferenceMakeRoom=function(a){vstack.log("INFO","please implement method: onConferenceMakeRoom, packet: "+JSON.stringify(a))},vstack.onConferenceJoinRoom=function(a){vstack.log("INFO","please implement method: onConferenceJoinRoom, packet: "+JSON.stringify(a))};